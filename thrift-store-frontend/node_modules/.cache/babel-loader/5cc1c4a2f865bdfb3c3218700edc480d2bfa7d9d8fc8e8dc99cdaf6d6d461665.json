{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useLocation}from'react-router-dom';import{useAuth}from'../contexts/AuthContext';import{API_URL}from'../config';import{FcGoogle}from'react-icons/fc';import'../styles/LoginPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoginPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const{currentUser,handleLogin}=useAuth();const navigate=useNavigate();const location=useLocation();useEffect(()=>{// Check for token in URL (for OAuth redirects)\nconst searchParams=new URLSearchParams(location.search);const token=searchParams.get('token');const errorMsg=searchParams.get('error');if(token){// Log the user in with the token from the URL\nconsole.log('Token found in URL, logging in user');handleLogin(token).then(()=>{// Clear the token from the URL\nnavigate('/',{replace:true});}).catch(err=>{console.error('Error logging in with token from URL:',err);setError('Failed to authenticate with token. Please try again.');});}else if(errorMsg){setError(decodeURIComponent(errorMsg));}},[location,handleLogin,navigate]);useEffect(()=>{if(currentUser){var _location$state;const redirectTo=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.from)||'/';navigate(redirectTo,{replace:true});}},[currentUser,location,navigate]);const handleEmailLogin=async e=>{e.preventDefault();try{setLoading(true);setError('');// Call your email login API endpoint\nconst response=await fetch(`${API_URL}/api/auth/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await response.json();if(!response.ok){throw new Error(data.message||data.error||'Failed to login');}await handleLogin(data.token);navigate('/',{replace:true});}catch(error){setError(error.message);}finally{setLoading(false);}};const handleGoogleLogin=()=>{window.location.href=`${API_URL}/api/auth/google`;};return/*#__PURE__*/_jsx(\"div\",{className:\"login-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Welcome Back\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sign in to access your account\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleEmailLogin,className:\"login-form\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",placeholder:\"Email address\",value:email,onChange:e=>setEmail(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-button\",disabled:loading,children:loading?'Signing in...':'Sign in'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"divider\",children:\"OR\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleGoogleLogin,disabled:loading,className:\"google-login-button\",children:[/*#__PURE__*/_jsx(FcGoogle,{className:\"google-icon\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Continue with Google\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"signup-link\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't have an account?\",' ',/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/register'),className:\"signup-button\",children:\"Sign up\"})]})})]})});};export default LoginPage;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","useAuth","API_URL","FcGoogle","jsx","_jsx","jsxs","_jsxs","LoginPage","email","setEmail","password","setPassword","error","setError","loading","setLoading","currentUser","handleLogin","navigate","location","searchParams","URLSearchParams","search","token","get","errorMsg","console","log","then","replace","catch","err","decodeURIComponent","_location$state","redirectTo","state","from","handleEmailLogin","e","preventDefault","response","fetch","method","headers","body","JSON","stringify","data","json","ok","Error","message","handleGoogleLogin","window","href","className","children","onSubmit","type","placeholder","value","onChange","target","required","disabled","onClick"],"sources":["/Volumes/CrucialSSD/Dell Laptop/A Drive/Thrift store/Thrift store/thrift-store-frontend/src/pages/LoginPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { API_URL } from '../config';\r\nimport { FcGoogle } from 'react-icons/fc';\r\nimport '../styles/LoginPage.css';\r\n\r\nconst LoginPage = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const { currentUser, handleLogin } = useAuth();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    // Check for token in URL (for OAuth redirects)\r\n    const searchParams = new URLSearchParams(location.search);\r\n    const token = searchParams.get('token');\r\n    const errorMsg = searchParams.get('error');\r\n    \r\n    if (token) {\r\n      // Log the user in with the token from the URL\r\n      console.log('Token found in URL, logging in user');\r\n      handleLogin(token)\r\n        .then(() => {\r\n          // Clear the token from the URL\r\n          navigate('/', { replace: true });\r\n        })\r\n        .catch(err => {\r\n          console.error('Error logging in with token from URL:', err);\r\n          setError('Failed to authenticate with token. Please try again.');\r\n        });\r\n    } else if (errorMsg) {\r\n      setError(decodeURIComponent(errorMsg));\r\n    }\r\n  }, [location, handleLogin, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (currentUser) {\r\n      const redirectTo = location.state?.from || '/';\r\n      navigate(redirectTo, { replace: true });\r\n    }\r\n  }, [currentUser, location, navigate]);\r\n\r\n  const handleEmailLogin = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      // Call your email login API endpoint\r\n      const response = await fetch(`${API_URL}/api/auth/login`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ email, password }),\r\n      });\r\n      \r\n      const data = await response.json();\r\n      if (!response.ok) {\r\n        throw new Error(data.message || data.error || 'Failed to login');\r\n      }\r\n      \r\n      await handleLogin(data.token);\r\n      navigate('/', { replace: true });\r\n    } catch (error) {\r\n      setError(error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleLogin = () => {\r\n    window.location.href = `${API_URL}/api/auth/google`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-page\">\r\n      <div className=\"login-container\">\r\n        <h2>Welcome Back</h2>\r\n        <p>Sign in to access your account</p>\r\n\r\n        {error && (\r\n          <div className=\"error-message\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <form onSubmit={handleEmailLogin} className=\"login-form\">\r\n          <div className=\"form-group\">\r\n            <input\r\n              type=\"email\"\r\n              placeholder=\"Email address\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n          <div className=\"form-group\">\r\n            <input\r\n              type=\"password\"\r\n              placeholder=\"Password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n          <button type=\"submit\" className=\"login-button\" disabled={loading}>\r\n            {loading ? 'Signing in...' : 'Sign in'}\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"divider\">OR</div>\r\n\r\n        <button\r\n          onClick={handleGoogleLogin}\r\n          disabled={loading}\r\n          className=\"google-login-button\"\r\n        >\r\n          <FcGoogle className=\"google-icon\" />\r\n          <span>Continue with Google</span>\r\n        </button>\r\n\r\n        <div className=\"signup-link\">\r\n          <p>\r\n            Don't have an account?{' '}\r\n            <button\r\n              onClick={() => navigate('/register')}\r\n              className=\"signup-button\"\r\n            >\r\n              Sign up\r\n            </button>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}